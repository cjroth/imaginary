<!DOCTYPE html>
<html>
  <head>
    <title><%= post.title %> - <%= blog.name %></title>
    <%- include head %>
    <link href='http://fonts.googleapis.com/css?family=Habibi|Gilda+Display|Poiret+One|Podkova|Gudea|Calligraffitti|Tangerine|Italianno|Julius+Sans+One|Playfair+Display+SC|Cinzel+Decorative|Cinzel|Asul|Amatic+SC|Trykker' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Princess+Sofia|Allura|Great+Vibes|Metamorphous|Maven+Pro|Rochester' rel='stylesheet' type='text/css'>
    <style type="text/css">
      body {
        margin: 100px auto;
        width: 960px;
        position: relative;
      }
      h1.title {
        font-family: 'Julius Sans One', sans-serif;
        font-size: 50px;
        line-height: 90px;
        margin: 0;
        letter-spacing: -8px;
        font-weight: bold;
        text-align: center;
        margin-bottom: 50px;
      }
      .essay {
        width: 500px;
        font-size: 16px;
        line-height: 34px;
        margin: 20px auto;
        text-align: left;
      }
      .essay span {
        padding: 5px;
        background: yellow;
      }
      .signature {
        font-family: 'Allura', cursive;
        font-size: 30px;
        margin: 40px 0;
      }
      .twitter-share-button {
        float: right;
      }
      .essay p {
        margin: 0 0 25px;
      }
      .post-options-toggle {
        margin-left: 20px;
      }
      .post-options-toggle {
        border-radius: 15px;
        background: #000 !important;
        border: none !important;
      }
    </style>
  </head>
  <body>

    <% if (user) { %>
      <% include header %>
    <% } %>

    <% if (user) { %>
      <div>
        <h1 class="title"><%= post.title %><button class="post-options-toggle btn btn-mini dropdown-toggle" type="button" data-toggle="dropdown"><span class="caret"></span></button></h1>
        <ul class="post-options dropdown-menu">
          <li><a href="/edit/<%= post.id %>">Edit</a></li>
          <li><a href="#delete-post-modal" data-toggle="modal">Delete</a></li>
          <li><a href="/publish<%= post.id %>">Publish</a></li>
        </ul>
      </div>
    <% } else { %>
      <h1 class="title"><%= post.title %></h1>
    <% } %>

    <div class="essay">

      <%- post.getHTML() %>

      <p class="signature">
        <% if (post.getConfig().include_signature) { %>
          Chris Roth - April 2, 2013
        <% } %>
        <% if (post.getConfig().include_tweet_button) { %>
          <a href="https://twitter.com/share" class="twitter-share-button" data-via="chrisrxth" data-size="large">Tweet</a>
          <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
        <% } %>
      </p>

    </div>

    <div id="delete-post-modal" class="modal" data-backdrop="false">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
            <h4 class="modal-title">Delete "<%= post.title %>"</h4>
          </div>
          <div class="modal-body">
            Are you sure you want to delete this post?
          </div>
          <div class="modal-footer">
            <a id="delete-post" href="#" class="btn btn-danger">Yes, Delete</a>
            <a href="#" class="btn" data-dismiss="modal">No, Cancel</a>
          </div>
        </div>
      </div>
    </div>

    <script>
    $('.post-options-toggle').click(function() {
      $('.post-options').toggle().position({
        my: 'right top',
        at: 'right bottom',
        of: $('.post-options-toggle')
      }).click(function() {
        $(this).hide();
      });
    });
    $('#delete-post').click(function() {
      $.post('/delete/<%= post.id %>', function(data) {
        if (!data.result) {
          // @todo handle error
        }
        window.location = '/';
      });
    });
    </script>

  </body>
</html>